<% if 1 == 1 %>
console.log('<%= @checkpoint.good_habit %>')
console.log('<%= @checkpoint.bad_habit %>')
console.log('1ruby')
console.log('1ruby')
<% end %>

if (1 == 1) {
  console.log('1js')
  console.log('1js')
  console.log('1js')
}

<% if !@checkpoint.good_habit.nil? %>
console.log('<%= @checkpoint.good_habit %>')
console.log('<%= @checkpoint.bad_habit %>')
console.log('1ruby')
console.log('1ruby')
<% end %>


<% if !@checkpoint.good_habit.nil? %>

function toPercentage(y, x) {
  return ((y/x)*100).toFixed(2)
}
toPercentage()
var successedCheckpoints = <%= @checkpoint.good_habit.checkpoints.where(checked: true).count %>
var failedCheckpoints = <%= @checkpoint.good_habit.announced_checkpoints %>
var result = toPercentage(successedCheckpoints, failedCheckpoints)

if (document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").classList.contains("btn-submit-danger")) {
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").remove()
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>).insertAdjacentHTML("afterbegin", "<%= j render 'checkpoint', checkpoint: @checkpoint %>")
  document.querySelectorAll(".habit-rigth-col-<%= @checkpoint.good_habit_id%>-grid .achievement-grid").forEach(el=>el.remove())
  document.querySelector(".habit-rigth-col-<%= @checkpoint.good_habit_id%>-grid").insertAdjacentHTML("afterbegin", "<%= j render 'numbers', checkpoint: @checkpoint %>")

  document.querySelector(".habit-days-<%= @checkpoint.good_habit_id%>").remove()
  document.querySelector(".spe-habit-days-<%= @checkpoint.good_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers3', checkpoint: @checkpoint %>")

  var res = document.querySelector(".infos-wrapper-<%= @checkpoint.good_habit_id%>")
  var res2 = res.querySelector(".invis-percentages")
  res2.remove()
  document.querySelector(".infos-wrapper-<%= @checkpoint.good_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers2', checkpoint: @checkpoint %>")

} else if (document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").classList.contains("btn-submit-success")) {
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").remove()
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>).insertAdjacentHTML("afterbegin", "<%= j render 'checkpoint', checkpoint: @checkpoint %>")
  document.querySelectorAll(".habit-rigth-col-<%= @checkpoint.good_habit_id%>-grid .achievement-grid").forEach(el=>el.remove())
  document.querySelector(".habit-rigth-col-<%= @checkpoint.good_habit_id%>-grid").insertAdjacentHTML("afterbegin", "<%= j render 'numbers', checkpoint: @checkpoint %>")
  document.querySelector(".habit-days-<%= @checkpoint.good_habit_id%>").remove()
  document.querySelector(".spe-habit-days-<%= @checkpoint.good_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers3', checkpoint: @checkpoint %>")
  
  var res = document.querySelector(".infos-wrapper-<%= @checkpoint.good_habit_id%>")
  var res2 = res.querySelector(".invis-percentages")
  res2.remove()

  document.querySelector(".infos-wrapper-<%= @checkpoint.good_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers2', checkpoint: @checkpoint %>")
}

var parentEl = document.querySelectorAll('#infos-wrapper')

parentEl.forEach(element => {
  var res = element.querySelector('.invis-percentages')
  element.addEventListener('mouseover', () => {
      res.style.display = 'block'
  })
})

parentEl.forEach(element => {
  var res = element.querySelector('.invis-percentages')
  element.addEventListener('mouseout', () => {
      res.style.display = 'none'
  })
})

function updateValue(e) {
  log.textContent = e.target.value;
}


// -------------------------------- //

<% elsif !@checkpoint.bad_habit.nil? %>

function toPercentage(y, x) {
  return ((y/x)*100).toFixed(2)
}
toPercentage()
var successedCheckpoints = <%= @checkpoint.bad_habit.checkpoints.where(checked: true).count %>
var failedCheckpoints = <%= @checkpoint.bad_habit.announced_checkpoints %>
var result = toPercentage(successedCheckpoints, failedCheckpoints)

if (document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").classList.contains("btn-submit-danger")) {
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").remove()
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>).insertAdjacentHTML("afterbegin", "<%= j render 'checkpoint', checkpoint: @checkpoint %>")
  document.querySelectorAll(".habit-rigth-col-<%= @checkpoint.bad_habit_id%>-grid .achievement-grid").forEach(el=>el.remove())
  document.querySelector(".habit-rigth-col-<%= @checkpoint.bad_habit_id%>-grid").insertAdjacentHTML("afterbegin", "<%= j render 'numbers', checkpoint: @checkpoint %>")

  document.querySelector(".habit-days-<%= @checkpoint.bad_habit_id%>").remove()
  document.querySelector(".spe-habit-days-<%= @checkpoint.bad_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers3', checkpoint: @checkpoint %>")

  var res = document.querySelector(".infos-wrapper-<%= @checkpoint.bad_habit_id%>")
  var res2 = res.querySelector(".invis-percentages")
  res2.remove()
  document.querySelector(".infos-wrapper-<%= @checkpoint.bad_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers2', checkpoint: @checkpoint %>")

} else if (document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").classList.contains("btn-submit-success")) {
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>+" input").remove()
  document.querySelector(".checkpoint-data-"+<%= @checkpoint.id %>).insertAdjacentHTML("afterbegin", "<%= j render 'checkpoint', checkpoint: @checkpoint %>")
  document.querySelectorAll(".habit-rigth-col-<%= @checkpoint.bad_habit_id%>-grid .achievement-grid").forEach(el=>el.remove())
  document.querySelector(".habit-rigth-col-<%= @checkpoint.bad_habit_id%>-grid").insertAdjacentHTML("afterbegin", "<%= j render 'numbers', checkpoint: @checkpoint %>")
  document.querySelector(".habit-days-<%= @checkpoint.bad_habit_id%>").remove()
  document.querySelector(".spe-habit-days-<%= @checkpoint.bad_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers3', checkpoint: @checkpoint %>")
  
  var res = document.querySelector(".infos-wrapper-<%= @checkpoint.bad_habit_id%>")
  var res2 = res.querySelector(".invis-percentages")
  res2.remove()

  document.querySelector(".infos-wrapper-<%= @checkpoint.bad_habit_id%>").insertAdjacentHTML("afterbegin", "<%= j render 'numbers2', checkpoint: @checkpoint %>")
}

var parentEl = document.querySelectorAll('#infos-wrapper')

parentEl.forEach(element => {
  var res = element.querySelector('.invis-percentages')
  element.addEventListener('mouseover', () => {
      res.style.display = 'block'
  })
})

parentEl.forEach(element => {
  var res = element.querySelector('.invis-percentages')
  element.addEventListener('mouseout', () => {
      res.style.display = 'none'
  })
})

function updateValue(e) {
  log.textContent = e.target.value;
}

<% end %>