<%= render partial: "elements/header-auth.html.erb" %>

<div class="page">
<h2 class="page-header"><%=@cycle.title.capitalize%> good habits</h2>

<div class="habits-grid-container">

<% @good_habits.each do |habit| %>
<div class="habit-grid" data-hover-target="#modal<%= habit.id%>">

<div class="modal" id="modal<%= habit.id%>"> 
  <div class="modal-header">
    <div class="modal-header-title"> 
    <h5><%= habit.title.capitalize %></h5>
    </div>
    <div class="modal-menu">
    <%= render partial: "elements/edit.html.erb" %>
    <%= render partial: "elements/delete.html.erb" %>
    <button data-close-button class="close-btn"><%= render partial: "elements/close.html.erb" %></button>
    </div>
  </div>
  <div class="modal-body">
  <div class="special-checkboxes">
    <% habit.checkpoints.sort {|a,b| a.id <=> b.id}.each do|checkpoint| %>
    <div class="checkboxe-element">
      <%= form_for habit, url: user_cycle_good_habit_checkpoint_path(@user.id, @cycle.title, habit.id, checkpoint.id), method: "PUT", remote: true do |form|%>
      <div class="checkpoint-data-<%= checkpoint.id %>" id="checkpoint">
        <% if checkpoint.checked == false %>
          <%= form.submit "Submit", :type => :image, :src => image_path("red_ck_3.png"), class: 'btn-submit-danger' %>
        <% elsif checkpoint.checked == true %>
          <%= form.submit "Submit", :type => :image, :src => image_path("green_ck_3.png"), class: 'btn-submit-success' %>
        <% end %>
      </div >
      <% end %>
    </div>
    <% end %>
  </div>
  </div>
</div>

<button  class="custom-model-button" data-modal-target="#modal<%= habit.id%>">

  <div class="habit-wrapper">
    <div class="habit-header">
    
      <%= habit.title.capitalize %>
    
      <p class="info-tag" id="<%= habit.id%>"> <%= render partial: "elements/info.html.erb" %></p>
    </div>
    <div class="habit-days">
      since 92 days
     
    </div>
    <% success = habit.checkpoints.where(checked: true).count.to_f %>
  <% total = habit.announced_checkpoints.to_i %>
  <% percentage = ((success/total)*100).round(2) %>
  <% left = total - success%>
    <div class="infos-wrapper-<%= habit.id%>" id="infos-wrapper">
    <div class="achievements-infos-<%= habit.id%>" id="achievements-infos">
    <p class="achievement-paragraph"><%= left.to_i %> checkpoints left </p>
    <p class="achievement-paragraph">current achivement success : <%= percentage %>% </p>
    </div>
    <div class="habit-rigth-col-<%= habit.id%>-grid" id="achievements-grid-wrapper">


<% if percentage == 0  %>
<div class="achievement-grid red"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<% elsif percentage >= 0 && percentage < 16.67 %>
<div class="achievement-grid red"></div>
<div class="achievement-grid red"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<div class="achievement-grid gray"></div>
<% elsif percentage >= 16.67 && percentage < 33.33 %>
  <div class="achievement-grid orange"></div>
  <div class="achievement-grid orange"></div>
  <div class="achievement-grid orange"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
<% elsif percentage >= 33.33 && percentage < 50 %>
<div class="achievement-grid orange"></div>
  <div class="achievement-grid orange"></div>
  <div class="achievement-grid orange"></div>
  <div class="achievement-grid orange"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
<% elsif percentage >= 50 && percentage < 66.67 %>
<div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
<% elsif percentage >= 66.67 && percentage < 83.33 %>
<div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid yellow"></div>
  <div class="achievement-grid gray"></div>
  <div class="achievement-grid gray"></div>
<% elsif percentage >= 83.33 && percentage < 100 %>
<div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid gray"></div>
<% elsif percentage == 100.0 %>
<div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  <div class="achievement-grid green"></div>
  </div>
<% end %>
    </div>
  </div>
 
  </button>

</div>


<% end %>


</div>
<div id="overlay"></div>
</div>



<%= javascript_pack_tag 'index_gh'%>
